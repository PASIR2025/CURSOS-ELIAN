<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crear cuenta</title>
  <style>
    body{font-family:system-ui;margin:0;background:#0b1220;color:#f9fafb;min-height:100vh;display:grid;place-items:center}
    .card{width:min(520px,92vw);border:1px solid rgba(148,163,184,.25);border-radius:18px;background:rgba(148,163,184,.06);padding:18px}
    h1{margin:0 0 12px;font-size:1.4rem}
    label{display:block;margin:10px 0 6px;color:#cbd5e1;font-size:.95rem}
    input{width:100%;padding:12px 12px;border-radius:12px;border:1px solid rgba(148,163,184,.25);background:rgba(2,6,23,.6);color:#f9fafb;outline:none}
    button{width:100%;padding:12px;border-radius:12px;border:0;background:#22c55e;color:#071018;font-weight:900;cursor:pointer;margin-top:14px}
    .row{display:flex;justify-content:space-between;gap:10px;margin-top:12px;flex-wrap:wrap}
    a{color:#38bdf8;text-decoration:none;font-weight:800}
    .muted{color:#9ca3af;font-size:.95rem}
    .err{margin-top:10px;color:#fca5a5;font-weight:700;white-space:pre-wrap}
    .ok{margin-top:10px;color:#86efac;font-weight:800;white-space:pre-wrap}
  </style>
</head>
<body>
  <div class="card">
    <h1>Crear cuenta</h1>
    <div class="muted">Regístrate para acceder a tus cursos comprados.</div>

    <label>Nombre</label>
    <input id="name" type="text" placeholder="Tu nombre" autocomplete="name" />

    <label>Correo</label>
    <input id="email" type="email" placeholder="tucorreo@gmail.com" autocomplete="email" />

    <label>Contraseña</label>
    <input id="pass" type="password" placeholder="Mínimo 6 caracteres" autocomplete="new-password" />

    <button id="btn">Registrar</button>
    <div id="msg" class="err" style="display:none"></div>
    <div id="ok" class="ok" style="display:none"></div>

    <div class="row">
      <span class="muted">¿Ya tienes cuenta? <a href="login.html">Iniciar sesión</a></span>
      <a href="index.html">Volver</a>
    </div>
  </div>

<script>

  const API_URL = 'https://script.google.com/macros/s/AKfycbxDqkSFvg7n7dxRkSk3w0x842bSW3aoODvTVlLoCyM4AJYFOhCmiOpG6ILv6uBlL-kgHg/exec';

  function jsonp(action, payload) {
    return new Promise((resolve, reject) => {
      const cb = "cb_" + Math.random().toString(36).slice(2);
      const params = new URLSearchParams();
      params.set("action", action);
      Object.entries(payload || {}).forEach(([k,v]) => {
        if (v === undefined || v === null) return;
        params.set(k, String(v));
      });
      params.set("callback", cb);

      const script = document.createElement("script");
      script.src = API_URL + "?" + params.toString();
      script.async = true;

      window[cb] = (data) => {
        cleanup();
        resolve(data);
      };

      function cleanup() {
        try { delete window[cb]; } catch(e) { window[cb] = undefined; }
        if (script.parentNode) script.parentNode.removeChild(script);
      }

      script.onerror = () => {
        cleanup();
        reject(new Error("No se pudo conectar (JSONP/CORS)."));
      };

      document.body.appendChild(script);
    });
  }


  function showErr(text) {
    document.getElementById("ok").style.display = "none";
    const el = document.getElementById("msg");
    el.style.display = "block";
    el.textContent = text;
  }

  function showOk(text) {
    document.getElementById("msg").style.display = "none";
    const el = document.getElementById("ok");
    el.style.display = "block";
    el.textContent = text;
  }

  document.getElementById("btn").onclick = async () => {
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("pass").value;

    if (!email || !password) return showErr("Correo y contraseña son requeridos.");

    try {
      const r = await jsonp("register", { name, email, password });
      if (!r.ok) return showErr(r.error || "No se pudo registrar");

      showOk("Cuenta creada. Ahora inicia sesión.");
      setTimeout(()=> location.href = "login.html", 800);
    } catch (e) {
      showErr(e.message);
    }
  };
</script>
</body>
</html>
